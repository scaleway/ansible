name: integration

on:
  pull_request:
  push:
    branches:
      - main
  # schedule:
  #   - cron: "0 6 * * *"
  workflow_dispatch:

jobs:
  integration:
    runs-on: ubuntu-latest
    timeout-minutes: 40
    strategy:
      fail-fast: false
      max-parallel: 1
      matrix:
        module: []
          # - scaleway_registry_v1_namespace

    steps:
      - name: Perform testing
        uses: ansible-community/ansible-test-gh-action@release/v1
        with:
          pre-test-cmd: >-
            SCW_ACCESS_KEY=${{ secrets.SCW_ACCESS_KEY }}
            SCW_SECRET_KEY=${{ secrets.SCW_SECRET_KEY }}
            SCW_DEFAULT_PROJECT_ID=${{ secrets.SCW_DEFAULT_PROJECT_ID }}
            eval
            "echo \"$(cat "tests/integration/integration_config.yml.template")\""
            > tests/integration/integration_config.yml
          target-python-version: 3.9
          controller-python-version: auto
          target: ${{ matrix.module }}
          testing-type: integration
