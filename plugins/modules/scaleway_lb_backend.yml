DOCUMENTATION:
  module: scaleway_lb_backend
  short_description: Manage Scaleway lb's backend
  description:
    - This module can be used to manage Scaleway lb's backend.
  version_added: "2.1.0"
  author:
    - Nathanael Demacon (@quantumsheep)
  extends_documentation_fragment:
    - scaleway.scaleway.scaleway
    - scaleway.scaleway.scaleway_waitable_resource
  requirements:
    - scaleway >= 0.6.0
  options:
    state:
      description:
        - Indicate desired state of the target.
        - C(present) will create the resource.
        - C(absent) will delete the resource, if it exists.
      default: present
      choices: ["present", "absent"]
      type: str
    backend_id:
      description: backend_id
      type: str
      required: false
    lb_id:
      description: lb_id
      type: str
      required: true
    forward_port:
      description: forward_port
      type: int
      required: true
    sticky_sessions_cookie_name:
      description: sticky_sessions_cookie_name
      type: str
      required: true
    health_check:
      description: health_check
      type: dict
      required: true
    server_ip:
      description: server_ip
      type: list
      elements: str
      required: true
    on_marked_down_action:
      description: on_marked_down_action
      type: str
      required: true
      choices:
        - on_marked_down_action_none
        - shutdown_sessions
    proxy_protocol:
      description: proxy_protocol
      type: str
      required: true
      choices:
        - proxy_protocol_unknown
        - proxy_protocol_none
        - proxy_protocol_v1
        - proxy_protocol_v2
        - proxy_protocol_v2_ssl
        - proxy_protocol_v2_ssl_cn
    region:
      description: region
      type: str
      required: false
      choices:
        - fr-par
        - nl-ams
        - pl-waw
    name:
      description: name
      type: str
      required: false
    forward_protocol:
      description: forward_protocol
      type: str
      required: true
      choices:
        - tcp
        - http
    forward_port_algorithm:
      description: forward_port_algorithm
      type: str
      required: true
      choices:
        - roundrobin
        - leastconn
        - first
    sticky_sessions:
      description: sticky_sessions
      type: str
      required: true
      choices:
        - none
        - cookie
        - table
    send_proxy_v2:
      description: send_proxy_v2
      type: bool
      required: false
    timeout_server:
      description: timeout_server
      type: str
      required: false
    timeout_connect:
      description: timeout_connect
      type: str
      required: false
    timeout_tunnel:
      description: timeout_tunnel
      type: str
      required: false
    failover_host:
      description: failover_host
      type: str
      required: false
    ssl_bridging:
      description: ssl_bridging
      type: bool
      required: false
    ignore_ssl_server_verify:
      description: ignore_ssl_server_verify
      type: bool
      required: false

EXAMPLES:
  - name: Create a backend
    scaleway.scaleway.scaleway_lb_backend:
      access_key: "{{ scw_access_key }}"
      secret_key: "{{ scw_secret_key }}"
      lb_id: "aaaaaa"
      forward_port: "aaaaaa"
      sticky_sessions_cookie_name: "aaaaaa"
      health_check:
        aaaaaa: bbbbbb
        cccccc: dddddd
      server_ip:
        - aaaaaa
        - bbbbbb
      on_marked_down_action: "aaaaaa"
      proxy_protocol: "aaaaaa"
      forward_protocol: "aaaaaa"
      forward_port_algorithm: "aaaaaa"
      sticky_sessions: "aaaaaa"

RETURN:
  backend:
    description: The backend information
    returned: when I(state=present)
    type: dict
    sample:
      id: 00000000-0000-0000-0000-000000000000
      name: "aaaaaa"
      forward_protocol: tcp
      forward_port: 3
      forward_port_algorithm: roundrobin
      sticky_sessions: none
      sticky_sessions_cookie_name: "aaaaaa"
      health_check:
        aaaaaa: bbbbbb
        cccccc: dddddd
      pool:
        - aaaaaa
        - bbbbbb
      lb:
        aaaaaa: bbbbbb
        cccccc: dddddd
      send_proxy_v2: true
      timeout_server: "aaaaaa"
      timeout_connect: "aaaaaa"
      timeout_tunnel: "aaaaaa"
      on_marked_down_action: on_marked_down_action_none
      proxy_protocol: proxy_protocol_none
      created_at: "aaaaaa"
      updated_at: "aaaaaa"
      failover_host: "aaaaaa"
      ssl_bridging: 00000000-0000-0000-0000-000000000000
      ignore_ssl_server_verify: true
